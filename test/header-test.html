<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Header Auto-Test</title>

    <!-- Core-Dateien absolut laden (GitHub Pages kompatibel) -->
    <script src="/cher-webapp-core/lib/core/init.js"></script>
    <script src="/cher-webapp-core/lib/core/config.js"></script>
    <script type="module" src="/cher-webapp-core/lib/core/loader.js"></script>


    <style>
        body {
            font-family: sans-serif;
        }

        .test-ok {
            color: #067a00;
            font-weight: 600;
        }

        .test-fail {
            color: #b30000;
            font-weight: 600;
        }
    </style>
</head>

<body class="bg-gray-50">

    <!-- Header absolut einbinden -->
    <div data-include="/cher-webapp-core/lib/components/header.html"></div>

    <main class="max-w-4xl mx-auto p-6">
        <h2 class="text-2xl font-bold mb-6">Automatischer Header-Komponenten-Test</h2>
        <p class="text-gray-600 mb-4">
            Diese Seite testet die header.html Komponente nach dem Laden durch den neuen Loader.
        </p>

        <div id="test-results" class="space-y-3 text-gray-800"></div>
    </main>

    <script>
        // Wir warten jetzt wirklich auf das Event, das der neue Loader garantiert feuert
        document.addEventListener("includesLoaded", () => {
            // kurzer Delay, damit DOM gerendert ist
            setTimeout(runTests, 50);
        });

        function runTests() {
            const results = document.getElementById("test-results");

            const config = window.appConfig || {};
            const titleEl = document.getElementById("app-title");
            const subtitleEl = document.getElementById("app-subtitle");

            const tests = [];

            // 1) Titel korrekt gesetzt?
            tests.push(check(
                "Der Titel wurde korrekt gesetzt.",
                titleEl && titleEl.textContent.trim() === config.appTitle
            ));

            // 2) Untertitel korrekt sichtbar / versteckt
            const subtitleShouldBeVisible = !!config.appSubtitle;
            const subtitleIsVisible = subtitleEl && !subtitleEl.classList.contains("hidden");

            tests.push(check(
                "Der Untertitel wird korrekt ein- oder ausgeblendet.",
                subtitleShouldBeVisible === subtitleIsVisible
            ));

            // 3) Existiert der Header wirklich?
            tests.push(check(
                "Der Header wurde geladen und enthält die erwarteten Elemente.",
                !!titleEl && !!subtitleEl
            ));

            // 4) Fallback → es sind keine JS-Fehler aufgetreten
            tests.push(check(
                "Kein Fehler beim Laden der Komponente aufgetreten.",
                true
            ));

            results.innerHTML = tests.join("");
        }

        function check(label, ok) {
            return `
                <div>
                    <span class="${ok ? 'test-ok' : 'test-fail'}">
                        ${ok ? "✔ OK" : "✘ FAIL"}
                    </span>
                    – ${label}
                </div>
            `;
        }
    </script>

</body>

</html>